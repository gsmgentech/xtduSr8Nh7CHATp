<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout | GTServer</title>

  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f2f4fb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b1220">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script>
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark')
    }
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<header class="header">
  <img src="img/headergentechservernew.png" alt="GTServer">
  <i class="fa-solid fa-ellipsis-vertical menu-toggle" id="menuToggle"></i>
</header>

<main class="wrapper checkout-wrap">

  <div class="page-title-wrap">
    <h2 class="page-title"></h2>
  </div>

  <div class="summary" id="summary" hidden>
    <div>
      <div class="total">
        â‚± <span id="totalPrice"></span>
      </div>
      <div class="unit" id="unitWrap" hidden>
        â‚± <span id="unitPrice"></span> / unit
      </div>
    </div>
  </div>

  <div class="section">
    <label>Email</label>
    <input type="email" id="email" required>
    <div class="note">Enter a valid email address to receive your order details.</div>
  </div>

  <div class="section" id="qtyWrap" hidden>
    <label>Quantity</label>
    <div class="qty">
      <button type="button" id="minus">âˆ’</button>
      <input id="quantity" value="1">
      <button type="button" id="plus">+</button>
    </div>
  </div>

  <!-- IMEI Result Modal -->
  <div id="imeiModal" class="modal-overlay" style="display:none;">
    <div class="modal-box">

      <!-- âœ… BLACKLIST BANNER -->
      <div id="blacklistBanner" class="processing-banner" style="display:none;">
        <i class="fa-solid fa-triangle-exclamation"></i>
        <span><strong>PROCESSING</strong> â€” FRP REMOVAL.</span>
      </div>

      <div class="modal-header">
        <h3 id="modalTitle">Samsung IMEI Check Status</h3>
        <button class="modal-close" onclick="closeImeiModal()">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="modal-body" id="modalBody"></div>

      <!-- âœ… ONLY ONE BUTTON (CENTERED) -->
      <div class="modal-footer" style="display:flex; justify-content:center; padding:14px 16px;">
        <button
          id="removeBlacklistBtn"
          type="button"
          class="pay-btn normal-btn"
          style="display:none; width: 100%; max-width: 260px; justify-content:center;"
          onclick="goToRemoveBlacklist()">
          <i class="fa-solid fa-unlock-keyhole"></i>
          Remove Blacklist (USD 165)
        </button>
      </div>

    </div>
  </div>

  <div id="dynamicFields"></div>

  <button type="button" class="pay-btn normal-btn" id="continueBtn">Place Order</button>
  <button class="back-btn" id="backBtn">Back</button>

  <div class="cart">ðŸ›’</div>

  <div class="description">
    âž¤ Samsung IMEI Check Service (All Models).<br><br>

    âž¤ You can submit either:<br>
    &nbsp;&nbsp;&nbsp;â€¢ IMEI Number<br>
    &nbsp;&nbsp;&nbsp;â€¢ Serial Number (S/N)<br><br>

    âž¤ 1. Make sure the IMEI or Serial Number is correct and complete.<br><br>

    âž¤ 2. Submit your order to check your Samsung device details/status.<br><br>

    <div class="note" style="margin-bottom: 10px;">
      Note: Results depend on what info is available in the Samsung/carrier/source database.
    </div>

    <span class="sample-link" onclick="openModal()">ðŸ“„ View Sample</span><br><br>

    <span style="color: red; font-weight: bold;">
      ðŸ”´ Please ensure all submitted information is accurate. <strong>Refunds will not be issued</strong> for incorrect or invalid submissions.
    </span>
  </div>
</main>

<script>
  // normalize input (remove spaces/newlines, lowercase)
  function normalizeImeiInput(value) {
    return (value || "")
      .toString()
      .replace(/\s+/g, "")
      .toLowerCase();
  }

  function showBlacklistBanner() {
    const b = document.getElementById("blacklistBanner");
    if (b) b.style.display = "flex";
  }

  function hideBlacklistBanner() {
    const b = document.getElementById("blacklistBanner");
    if (b) b.style.display = "none";
  }

  function showRemoveBlacklistButton() {
    const btn = document.getElementById("removeBlacklistBtn");
    if (btn) btn.style.display = "inline-flex";
  }

  function hideRemoveBlacklistButton() {
    const btn = document.getElementById("removeBlacklistBtn");
    if (btn) btn.style.display = "none";
  }

  function openImeiModal(title, html) {
    document.getElementById("modalTitle").textContent = title;
    document.getElementById("modalBody").innerHTML = html;

    // reset banner + button every time
    hideBlacklistBanner();
    hideRemoveBlacklistButton();

    document.getElementById("imeiModal").style.display = "flex";
  }

  function closeImeiModal() {
    document.getElementById("imeiModal").style.display = "none";
  }

  // click outside to close
  document.addEventListener("click", function(e) {
    const modal = document.getElementById("imeiModal");
    if (!modal || modal.style.display !== "flex") return;
    if (e.target === modal) closeImeiModal();
  });

  function pill(status) {
    const s = (status || "").toLowerCase();
    if (s.includes("blacklist")) return `<span class="status-pill status-blacklist">Blacklist</span>`;
    if (s.includes("active") || s.includes("clean") || s.includes("found")) return `<span class="status-pill status-ok">${status}</span>`;
    return `<span class="status-pill status-unknown">${status}</span>`;
  }

  function renderSamsungResult() {
    const data = [
      ["Manufacturer", "Samsung Electronics Vietnam Co., Ltd. (SEVT)"],
      ["Full Name", "MOBILE SM-S93BJ BLACK KDI"],
      ["Model Name", "Galaxy S25 Ultra"],
      ["Model Number", "SM-S938JZKAKDI"],
      ["Model Code", "GALAXY S25 ULTRA"],
      ["Model Name (Carrier)", "SCG32"],
      ["IMEI1", "350883720373070"],
      ["IMEI2", "352396300373079"],
      ["Serial Number", "R5CY12K92ED"],
      ["Production Date", "15 January 2025"],
      ["Purchase Date", "17 January 2025"],
      ["Warranty Until", "17 January 2026"],
      ["Warranty Status", "Warranty Active"],
      ["Carrier", "KDDI Japan"],
      ["Purchase Country", "Japan"]
    ];

    const carrierStatus = [
      ["UQ Status", "Unknown"],
      ["KDDI Status", "Blacklist"],
      ["Mineo Status", "Not Found"],
      ["Docomo Status", "Not Found"],
      ["Rakuten Status", "Unknown"],
      ["Softbank Status", "Not Found"]
    ];

    let html = `<div class="result-grid">`;

    html += `<div style="font-weight:800;margin:2px 0 6px;">Device Information</div>`;
    data.forEach(([k, v]) => {
      html += `
        <div class="result-item">
          <div class="label">${k}</div>
          <div class="value">${v}</div>
        </div>`;
    });

    html += `<div style="font-weight:800;margin:14px 0 6px;">Carrier / Network Status</div>`;
    carrierStatus.forEach(([k, v]) => {
      html += `
        <div class="result-item">
          <div class="label">${k}</div>
          <div class="value">${pill(v)}</div>
        </div>`;
    });

    html += `</div>`;
    return html;
  }

  function showInvalidError() {
    openImeiModal(
      "Invalid Input",
      `<div class="error-box">
        Invalid IMEI or Serial Number. Please verify the details and try again.
      </div>`
    );
  }

  // redirect for Remove Blacklist
  function goToRemoveBlacklist() {
    // Change to your real service page
    window.location.href = "remove-blacklist.html";
  }

  // MAIN: Place Order button logic
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("continueBtn");
    if (!btn) return;

    btn.addEventListener("click", function(e) {
      // HARD BLOCK original checkout scripts
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();

      btn.blur();

      const imeiInput =
        document.getElementById("imei") ||
        document.querySelector('input[name="imei"]') ||
        document.querySelector("#dynamicFields input");

      if (!imeiInput) {
        openImeiModal("System Error", `<div class="error-box">IMEI/Serial input field not found.</div>`);
        return false;
      }

      const raw = imeiInput.value || "";
      const val = normalizeImeiInput(raw);

      const allowedPatterns = [
        "imei1:350883720373070",
        "imei:352396300373079",
        "serialnumber:r5cy12k92ed",
        "350883720373070",
        "352396300373079",
        "r5cy12k92ed"
      ];

      const matched = allowedPatterns.some(p => val.includes(p));

      if (matched) {
        openImeiModal("Samsung IMEI Check Status", renderSamsungResult());

        // Show banner + button for blacklist
        showBlacklistBanner();
        showRemoveBlacklistButton();
      } else {
        showInvalidError();
      }

      return false;
    }, true); // capture mode
  });
</script>

<script src="js/app.chk.min.js?v=1.0.6"></script>
<script src="js/app.flow.min.js?v=1.0.6"></script>

<script src="js/app.core.min.js?v=1.0.4" defer></script>
<script src="js/app.boot.min.js?v=1.0.4" defer></script>
<script src="js/app.guard.min.js?v=1.0.4" defer></script>

</body>
</html>
